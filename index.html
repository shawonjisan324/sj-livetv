
<body>

<!-- TOP -->
<div id="top">
  <select id="category" onchange="applyFilter()">
    <option value="all">All</option>
    <option value="fav">â¤ï¸ Favorites</option>
    <option value="bangla">Bangla ğŸ‡§ğŸ‡©</option>
    <option value="indian_bangla">Indian Bangla ğŸ‡®ğŸ‡³</option>
    <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
    <option value="others">Others ğŸŒ</option>
  </select>

  <input id="search" placeholder="Search channel..." onkeyup="applyFilter()">

  <div id="count">Loading...</div>
</div>

<!-- MAIN -->
<div id="main">
  <div id="left"></div>
  <div id="right">
    <video id="player" controls autoplay></video>
    <div id="volumeBox">100</div>
  </div>
</div>

<script>
/* ğŸ”’ PERMANENT SERVERS */
const SERVERS = [
  "playlist.m3u"
];
let channels = [];
let channelMap = new Map();
let hls = null;
const videoTest = document.createElement("video");
const countBox = document.getElementById("count");

/* FAVORITES */
function getFavs(){
  return JSON.parse(localStorage.getItem("favs") || "[]");
}
function isFav(url){
  return getFavs().some(f => f.url === url);
}
function toggleFav(ch){
  let favs = getFavs();
  const i = favs.findIndex(f => f.url === ch.url);
  if(i >= 0) favs.splice(i,1);
  else favs.push(ch);
  localStorage.setItem("favs", JSON.stringify(favs));
}

/* AUTO LOAD */
window.addEventListener("load", () => {
  SERVERS.forEach(loadServer);
});

/* LOAD SERVER */
async function loadServer(serverUrl){
  const url = "https://corsproxy.io/?" + encodeURIComponent(serverUrl);
  try{
    const res = await fetch(url);
    const text = await res.text();
    parseM3U(text);
  }catch{
    console.log("Server failed:", serverUrl);
  }
}

/* CATEGORY DETECT */
function detectCategory(name){
  const n = name.toLowerCase();
  if(n.includes("star jalsha")||n.includes("zee bangla")||n.includes("colors bangla"))
    return "indian_bangla";
  if(n.includes("sony")||n.includes("zee tv")||n.includes("star plus")||
     n.includes("colors")||n.includes("sab"))
    return "hindi";
  if(n.includes("bangla")||n.includes("bd")||n.includes("deshi"))
    return "bangla";
  return "others";
}

/* PLAYABLE CHECK */
function isPlayable(url){
  if(url.endsWith(".m3u8")) return Hls.isSupported();
  if(url.endsWith(".mp4"))
    return videoTest.canPlayType("video/mp4") !== "";
  return false;
}

/* PARSE */
function parseM3U(data){
  let name="", logo="";
  data.split("\n").forEach(l=>{
    l = l.trim();
    if(l.startsWith("#EXTINF")){
      name = l.split(",").pop();
      const m = l.match(/tvg-logo="([^"]+)"/);
      logo = m ? m[1] : "";
    }
    else if(l.startsWith("http")){
      if(!isPlayable(l)) return;
      const key = name.toLowerCase() + "|" + l;
      if(channelMap.has(key)) return;
      channelMap.set(key, true);
      channels.push({ name, url:l, logo, cat: detectCategory(name) });
    }
  });
  applyFilter();
}

/* RENDER */
function render(list){
  left.innerHTML = "";
  list.forEach(c=>{
    const d = document.createElement("div");
    d.className = "channel";
    d.innerHTML = `
      <img src="${c.logo || 'https://via.placeholder.com/36'}">
      <span>${c.name}</span>
      <span class="fav">${isFav(c.url) ? "â˜…" : "â˜†"}</span>
    `;
    d.querySelector(".fav").onclick = e => {
      e.stopPropagation();
      toggleFav(c);
      applyFilter();
    };
    d.onclick = () => play(c.url);
    left.appendChild(d);
  });
}

/* PLAY */
function play(url){
  if(hls){ hls.destroy(); hls = null; }
  if(url.endsWith(".mp4")){
    player.src = url; player.play(); return;
  }
  if(Hls.isSupported()){
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(player);
  } else {
    player.src = url;
  }
}

/* FILTER */
function applyFilter(){
  const c = category.value;
  const t = search.value.toLowerCase();

  let list = channels;

  if(c === "fav"){
    list = getFavs();
  } else if(c !== "all"){
    list = list.filter(ch => ch.cat === c);
  }

  list = list.filter(ch => ch.name.toLowerCase().includes(t));

  render(list);
  countBox.textContent = `Showing: ${list.length} / Total: ${channels.length}`;
}

/* ğŸ”Š VOLUME */
const video = document.getElementById("player");
const volumeBox = document.getElementById("volumeBox");
let volumeTimer = null;

document.getElementById("right").addEventListener("wheel", e => {
  e.preventDefault();
  let v = video.volume;
  v += (e.deltaY < 0 ? 0.05 : -0.05);
  v = Math.max(0, Math.min(1, v));
  video.volume = v;

  volumeBox.style.display = "block";
  volumeBox.textContent = v === 0 ? "MUTE" : Math.round(v * 100);

  clearTimeout(volumeTimer);
  volumeTimer = setTimeout(() => volumeBox.style.display = "none", 1000);
},{ passive:false });
</script>

</body>

</html>

